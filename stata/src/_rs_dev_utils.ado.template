* =============================================================================
* RegiStream Development Utilities TEMPLATE
* =============================================================================
*
* This file overrides production values (API host, version) for local development.
*
* To enable development mode:
* 1. Copy this file to _rs_dev_utils.ado (without .template extension)
*    cp stata/src/_rs_dev_utils.ado.template stata/src/_rs_dev_utils.ado
*
* 2. Customize the settings below for your local environment
*
* 3. The .gitignore will prevent you from accidentally committing this file
*
* 4. Start your local Flask API server:
*    cd /path/to/flask/app
*    flask run --host=0.0.0.0 --port=5000
*
* 5. Run Stata commands normally - they'll hit your localhost API
*
* Production values (hardcoded in _rs_utils.ado):
*   - API host: https://registream.org (line 193)
*   - Version: {{VERSION}} (line 405, replaced during export)
*
* Dev overrides (defined below):
*   - API host: http://localhost:5000
*   - Version: 2.0.0
* =============================================================================

cap program drop _rs_dev_utils
program define _rs_dev_utils, rclass
	version 16.0

	gettoken subcmd 0 : 0, parse(" ,")

	if ("`subcmd'" == "get_version") {
		* Override production version (production: "{{VERSION}}")
		* For testing: can override with $REGISTREAM_TEST_VERSION global
		if ("$REGISTREAM_TEST_VERSION" != "") {
			return local version "$REGISTREAM_TEST_VERSION"
		}
		else {
			return local version "2.0.0"
		}
	}
	else if ("`subcmd'" == "get_host") {
		* Override production API host (production: "https://registream.org")
		* For testing: can override with $REGISTREAM_TEST_HOST global
		if ("$REGISTREAM_TEST_HOST" != "") {
			return local host "$REGISTREAM_TEST_HOST"
		}
		else {
			return local host "http://localhost:5000"
		}
	}
	else {
		di as error "Invalid _rs_dev_utils subcommand: `subcmd'"
		exit 198
	}
end

* =============================================================================
* Development configuration globals (optional settings)
* =============================================================================

* Auto-approve all prompts (comment out to see interactive prompts)
global REGISTREAM_AUTO_APPROVE "yes"

* Optionally override registream directory for isolated testing
* global registream_dir "/tmp/registream_test"

* Development flags (enables debug output)
* global REGISTREAM_DEBUG "1"
